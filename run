#!/bin/bash

exitfn () {
    trap SIGINT              # Restore signal handling for SIGINT
    echo; echo "Stopping mriregistry now!"
    echo "You might need sudo to kill the rmiregistry process"
    killall rmiregistry
    echo "Removing generated files"
    rm *.class
    exit                     #   then exit script.
}

# grab pwd
PWD=$(pwd)
echo "Current Working Directory = $PWD"

trap "exitfn" INT


# COMPILE .JAVA FILES
echo "Compiling..."
javac *.java

# START RMIREGISTRY
echo "Starting registry..."
rmiregistry &
sleep 1

# START SERVER
echo "Starting rmi server..."
java -Djava.rmi.server.hostname=0.0.0.0 -Djava.rmi.server.codebase="file:$PWD" AsteroidsServer &

sleep 1

# START CLIENT 
echo "Starting client..."
java AsteroidsClient "0.0.0.0" "user1"

# TRAP SIGNAL TO STOP RMIREGISTRY
trap SIGINT
