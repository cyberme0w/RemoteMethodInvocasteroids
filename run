#!/bin/bash

exitfn () {
    trap SIGINT              # Restore signal handling for SIGINT
    echo; echo "Trying to kill processes..."
    kill $pidCLIENT $pidSERVER $pidRMI
    echo "Removing generated files"
    rm *.class
    exit                     #   then exit script.
}

# grab pwd
PWD=$(pwd)
echo "Current Working Directory = $PWD"

trap "exitfn" INT


# COMPILE .JAVA FILES
echo "Compiling..."
javac *.java

# START RMIREGISTRY
echo "Starting registry..."
eval "rmiregistry &"
pidRMI=$!
echo "Started registry with PID $pidRMI"
sleep 2

# START SERVER
echo "Starting server..."
eval "java -Djava.rmi.server.hostname=0.0.0.0 -Djava.rmi.server.codebase=file://$PWD AsteroidsServer &"
pidSERVER=$!
echo "Started server with PID $pidSERVER"
sleep 2

# START CLIENT 
echo "Starting client..."
eval "java AsteroidsClient 0.0.0.0 some_user"
pidCLIENT=$!


# TRAP SIGNAL TO STOP RMIREGISTRY
trap SIGINT
